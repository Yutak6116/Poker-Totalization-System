<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/spade.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Poker Totalization System</title>
    <style>
      /* LINE内ブラウザ用の外部ブラウザ誘導オーバーレイ */
      #line-external-open {
        display: none;
        position: fixed;
        inset: 0;
        background: #fff;
        z-index: 2147483647;
        padding: 24px;
        color: #111;
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto,
          Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji",
          "Segoe UI Symbol", sans-serif;
        line-height: 1.6;
      }
      #line-external-open .container {
        max-width: 720px;
        margin: 0 auto;
      }
      #line-external-open h2 {
        font-size: 20px;
        margin: 8px 0 12px;
      }
      #line-external-open p {
        margin: 0 0 16px;
      }
      #line-external-open .actions {
        display: flex;
        gap: 12px;
        margin: 12px 0 8px;
        flex-wrap: wrap;
      }
      #line-external-open a.btn,
      #line-external-open button.btn {
        appearance: none;
        border: none;
        background: #111827;
        color: #fff;
        padding: 10px 14px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 600;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        cursor: pointer;
        display: inline-block;
      }
      #line-external-open .hint {
        background: #f3f4f6;
        border-radius: 12px;
        padding: 12px;
        font-size: 14px;
      }
      #line-external-open code {
        background: #eef2ff;
        padding: 2px 6px;
        border-radius: 6px;
      }
    </style>
    <script>
      (function () {
        try {
          var ua = navigator.userAgent || "";
          var isLINE = /Line\/|LIAPP|NAVER LINE/i.test(ua);
          if (!isLINE) return; // 通常ブラウザはそのまま

          var isAndroid = /Android/i.test(ua);
          var isIOS = /iP(hone|od|ad)/i.test(ua);

          function showOverlay() {
            var el = document.getElementById("line-external-open");
            if (el) el.style.display = "block";
          }

          // Androidではintentスキームで外部ブラウザ起動を試みる
          if (isAndroid) {
            var scheme = location.protocol.replace(":", ""); // http or https
            var intentUrl =
              "intent://" +
              location.host +
              location.pathname +
              location.search +
              location.hash +
              "#Intent;scheme=" +
              scheme +
              ";end";
            // 自動で外部ブラウザへ移動を試みる
            location.replace(intentUrl);
            // もしブロック/失敗した場合に備え、案内オーバーレイを表示
            setTimeout(showOverlay, 1200);
            return;
          }

          // iOSは仕様上ユーザー操作なく外部ブラウザ起動ができないため、案内を表示
          if (isIOS) {
            if (document.readyState === "loading") {
              document.addEventListener("DOMContentLoaded", showOverlay);
            } else {
              showOverlay();
            }
            return;
          }
        } catch (e) {
          // 失敗時は何もしない
        }
      })();
      // オーバーレイ内ボタンの初期化
      (function () {
        function init() {
          var openBtn = document.getElementById("open-external-btn");
          if (openBtn) {
            var ua = navigator.userAgent || "";
            var isIOS = /iP(hone|od|ad)/i.test(ua);
            var isAndroid = /Android/i.test(ua);
            var href = location.href;
            // iOS Chromeがある場合に機能するgooglechromeスキームへ差し替え試行
            if (isIOS) {
              try {
                var url = new URL(href);
                if (url.protocol === "https:") {
                  href = href.replace(/^https:\/\//, "googlechromes://");
                } else if (url.protocol === "http:") {
                  href = href.replace(/^http:\/\//, "googlechrome://");
                }
              } catch (e) {
                // 無視して通常URLにフォールバック
              }
              // iOSのLINEでは target="_blank" は新規WebViewになることが多いので削除
              openBtn.removeAttribute("target");
              // noopenerは残しておく
            }
            // AndroidのLINE内でも新規タブはWebView内になるため、同様に_blankは外す
            if (isAndroid) {
              openBtn.removeAttribute("target");
            }
            openBtn.setAttribute("href", href);
            // クリックで直接遷移（iOS LINE内での新規WebView回避）
            openBtn.addEventListener("click", function (ev) {
              try {
                ev.preventDefault();
              } catch (_) {}
              try {
                location.href = href;
              } catch (_) {}
            });
            // iOS時、Chrome未インストール利用者向けに導線表示
            if (isIOS) {
              var installBtn = document.getElementById("install-chrome-btn");
              if (installBtn) installBtn.style.display = "inline-block";
            }
          }
          var urlEl = document.getElementById("page-url");
          if (urlEl) urlEl.textContent = location.href;
          var copyBtn = document.getElementById("copy-url-btn");
          if (copyBtn && navigator.clipboard) {
            copyBtn.addEventListener("click", function () {
              navigator.clipboard
                .writeText(location.href)
                .then(function () {
                  try {
                    alert(
                      "URLをコピーしました。外部ブラウザに貼り付けて開いてください。"
                    );
                  } catch (_) {}
                })
                .catch(function () {
                  try {
                    alert(
                      "コピーに失敗しました。手動でURLを選択してコピーしてください。"
                    );
                  } catch (_) {}
                });
            });
          }
        }
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", init);
        } else {
          init();
        }
      })();
    </script>
  </head>
  <body>
    <div id="line-external-open" role="dialog" aria-live="polite">
      <div class="container">
        <h2>外部ブラウザで開いてください</h2>
        <p>
          このページはLINEアプリ内のブラウザでは正しく動作しません。以下のボタンで外部ブラウザで開くか、画面のメニューから「ブラウザで開く」を選択してください。
        </p>
        <div class="actions">
          <a id="open-external-btn" class="btn" rel="noopener"
            >外部ブラウザで開く</a
          >
          <button id="copy-url-btn" class="btn" type="button">
            URLをコピー
          </button>
        </div>
        <div class="hint">現在のURL: <code id="page-url"></code></div>
        <details class="hint" style="margin-top: 12px">
          <summary>「外部ブラウザで開く」ボタンが機能しない場合</summary>
          <ol style="margin: 8px 0 0 18px">
            <li>画面右下の「︙」メニューをタップ</li>
            <li>ブラウザで開くを選択</li>
            <li>
              もしくは上の「URLをコピー」でURLをコピーし、ブラウザに貼り付けて開く
            </li>
          </ol>
        </details>
      </div>
    </div>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
